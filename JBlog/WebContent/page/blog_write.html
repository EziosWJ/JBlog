<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="static/icon/favicon.ico">

    <title>JBlog</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!--<link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet">-->

    <!-- Custom styles for this template -->
    <link href="css/blog-main.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">

</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">JBlog</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">Link</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">Dropdown <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">Separated link</a></li>
                    </ul>
                </li>
            </ul>
        </div><!--/.navbar-collapse -->
    </div>
</nav>

<!-- Main jumbotron for a primary marketing message or call to action -->
<div class="jumbotron">
    <div class="container">
        <h1>Hello, world!</h1>
        <p>This is a template for a simple marketing or informational website. It includes a large callout called a
            jumbotron and three supporting pieces of content. Use it as a starting point to create something more
            unique.</p>
        <p><a class="btn btn-primary btn-lg" href="#start" role="button">Learn more &raquo;</a></p>
    </div>
</div>

<div class="container" id="start">

    <div class="row">
        <div class="col-md-offset-1 col-md-10">
            <div class="row article_row">
                <div class="page-header">
                    <div class="input-group">
                        <span class="input-group-addon" id="sizing-addon1">标题：</span>
                        <input id="article_Title" class="form-control" type="text" placeholder="请输入标题" />
                    </div>
                </div>
                <form id="blog">
                    <div class="row article_row_content">
                        <!--wangEditor-->
                        <div class="" id="editor" style="margin: 0px 20px 35px 20px;">


                        </div>
                        <!--Editor end-->
                    </div>
                    <div class="row">
                        <div class="text-center">
                            <!-- Provides extra visual weight and identifies the primary action in a set of buttons -->
                            <button id="submit" type="button" class="btn btn-primary">提交</button>
                            <!-- Standard button -->
                            <button type="button" class="btn btn-default">保存</button>
                        </div>
                        <div class="pull-left">
                            <button id="testb1" type="button" class="btn btn-warning">获取内容</button>
                            <button id="testb2" type="button" class="btn btn-warning">转换内容</button>
                            <button id="testb3" type="button" class="btn btn-warning">设置HTML内容</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>

<div class="container">

    <hr >
        <footer class="footer navbar-fixed-bottom text-center">
            <p>&copy; 2018 Company, Inc.</p>
        </footer>

</div> <!-- /container -->


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="plugins/wangEditor.js"></script>
<script src="plugins/AppUtils.js"></script>
<script>
    var E = window.wangEditor;
    var editor = new E('#editor');
    //配置上传图片地址
    editor.customConfig.uploadImgServer = getContextPath() + 'upload/uploadImges';
    editor.customConfig.uploadFileName = 'img';
    editor.customConfig.uploadImgParams = {
        project: 'xxx'  // 需要传递的参数
    };
    //将传递的参数拼接到上传地址后面
    editor.customConfig.uploadImgParamsWithUrl = true;
    editor.customConfig.uploadImgHooks = {
        before: function (xhr, editor, files) {
            // 图片上传之前触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，files 是选择的图片文件

            // 如果返回的结果是 {prevent: true, msg: 'xxxx'} 则表示用户放弃上传
            // return {
            //     prevent: true,
            //     msg: '放弃上传'
            // }
            console.log("开始上传");
        },
        success: function (xhr, editor, result) {
            // 图片上传并返回结果，图片插入成功之后触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，result 是服务器端返回的结果
            console.log("发送成功 返回result：" + result);
        },
        fail: function (xhr, editor, result) {
            // 图片上传并返回结果，但图片插入错误时触发
                // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，result 是服务器端返回的结果
            console.log("发送失败 返回result：" + result);
        },
        error: function (xhr, editor) {
            // 图片上传出错时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象
            console.log("上传发生错误");
        },
        timeout: function (xhr, editor) {
            // 图片上传超时时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象
            console.log("上传超时");
        },

        // 如果服务器端返回的不是 {errno:0, data: [...]} 这种格式，可使用该配置
        // （但是，服务器端返回的必须是一个 JSON 格式字符串！！！否则会报错）
        // customInsert: function (insertImg, result, editor) {
            // 图片上传并返回结果，自定义插入图片的事件（而不是编辑器自动插入图片！！！）
            // insertImg 是插入图片的函数，editor 是编辑器对象，result 是服务器端返回的结果

            // 举例：假如上传图片成功后，服务器端返回的是 {url:'....'} 这种格式，即可这样插入图片：
            // var url = result.url
            // insertImg(url)

            // result 必须是一个 JSON 格式字符串！！！否则报错
        // }
    }
    editor.create();



/**
*@author wangj
*@date 2018-09-17 20:28:22
*@Description 提交文章
*/
    $('#submit').click(function () {
        var article_Title = $('#article_Title').val();
        var article_Content = HTMLEncode(editor.txt.html());
        console.info(article_Title+article_Content);
        var params = $.extend({},{article_Title:article_Title},{article_Content:article_Content});
        jqyAsyncJsonPost2(getContextPath()+"article/submitArticle",params,function (rtn) {
            var data = rtn;
            console.info(data);
            editor.txt.html("");
            window.location.href = getContextPath() + "article";
        })
    });
    $('#testb1').click(function () {
        var a = editor.txt.html();
        alert(a);
    });
    $('#testb2').click(function () {
        var a = HTMLEncode(editor.txt.html());
        alert(a);
    });
    $('#testb3').click(function () {
        var a = HTMLEncode(editor.txt.html());
        editor.txt.append("&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h1&gt;h标签&lt;/h1&gt;");
    });

</script>
</body>
</html>
